{"version":3,"sources":["../src/DeployList.js"],"names":["WEBHOOK_TYPE","WEBHOOK_QUERY","DeployList","isLoadingInitialList","setIsLoading","webhooks","setWebhooks","fetchInitialList","client","fetch","then","onSubscriptionUpdate","res","wasCreated","mutations","some","item","Object","prototype","hasOwnProperty","call","wasDeleted","result","filter","hook","_id","documentId","subscription","listen","includeResult","subscribe","unsubscribe","map","length"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;;;;;;;;;;;;;;;;;;;AAEA,IAAMA,YAAY,GAAG,gBAArB;AACA,IAAMC,aAAa,0BAAkBD,YAAlB,4BAAnB,C,CAEA;AACA;AACA;;AAEA,IAAME,UAAU,GAAG,MAAM;AACxB,kBAA6C,qBAAS,KAAT,CAA7C;AAAA;AAAA,MAAOC,oBAAP;AAAA,MAA6BC,YAA7B;;AACA,mBAAgC,qBAAS,EAAT,CAAhC;AAAA;AAAA,MAAOC,QAAP;AAAA,MAAiBC,WAAjB;;AAEA,MAAMC,gBAAgB,GAAG,MAAM;AAC9BH,IAAAA,YAAY,CAAC,IAAD,CAAZ;;AAEAI,oBAAOC,KAAP,CAAaR,aAAb,EAA4BS,IAA5B,CAAiCL,QAAQ,IAAI;AAC5CC,MAAAA,WAAW,CAACD,QAAD,CAAX;AACAD,MAAAA,YAAY,CAAC,KAAD,CAAZ;AACA,KAHD;AAIA,GAPD;;AASA,MAAMO,oBAAoB,GAAGC,GAAG,IAAI;AACnC,QAAMC,UAAU,GAAGD,GAAG,CAACE,SAAJ,CAAcC,IAAd,CAAmBC,IAAI,IACzCC,MAAM,CAACC,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCJ,IAArC,EAA2C,QAA3C,CADkB,CAAnB;AAGA,QAAMK,UAAU,GAAGT,GAAG,CAACE,SAAJ,CAAcC,IAAd,CAAmBC,IAAI,IACzCC,MAAM,CAACC,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCJ,IAArC,EAA2C,QAA3C,CADkB,CAAnB;;AAIA,QAAIH,UAAJ,EAAgB;AACfP,MAAAA,WAAW,CAAC,CAAC,GAAGD,QAAJ,EAAcO,GAAG,CAACU,MAAlB,CAAD,CAAX;AACA,KAFD,MAEO,IAAID,UAAJ,EAAgB;AACtBf,MAAAA,WAAW,CAACD,QAAQ,CAACkB,MAAT,CAAgBC,IAAI,IAAIA,IAAI,CAACC,GAAL,KAAab,GAAG,CAACc,UAAzC,CAAD,CAAX;AACA;AACD,GAbD,CAbwB,CA4BxB;;;AACA,wBAAUnB,gBAAV,EAA4B,EAA5B,EA7BwB,CA+BxB;;AACA,wBAAU,MAAM;AACf,QAAMoB,YAAY,GAAGnB,gBACnBoB,MADmB,CACZ3B,aADY,EACG,EADH,EACO;AAAC4B,MAAAA,aAAa,EAAE;AAAhB,KADP,EAEnBC,SAFmB,CAETnB,oBAFS,CAArB,CADe,CAKf;;;AACA,WAAO,MAAM;AACZgB,MAAAA,YAAY,CAACI,WAAb;AACA,KAFD;AAGA,GATD,EASG,CAACpB,oBAAD,CATH;AAWA,SAAOR,oBAAoB,gBAC1B,6BAAC,OAAD;AAAK,IAAA,OAAO,EAAE;AAAd,kBACC,6BAAC,WAAD,OADD,CAD0B,gBAK1B,6BAAC,SAAD;AAAO,IAAA,KAAK,EAAE;AAAd,KACEE,QAAQ,CAAC2B,GAAT,CAAaR,IAAI,iBACjB,6BAAC,mBAAD;AAAY,IAAA,GAAG,EAAEA,IAAI,CAACC,GAAtB;AAA2B,IAAA,IAAI,EAAED;AAAjC,IADA,CADF,EAIE,CAACnB,QAAQ,CAAC4B,MAAV,iBACA,6BAAC,QAAD;AAAM,IAAA,OAAO,EAAE,CAAf;AAAkB,IAAA,MAAM,EAAE,CAA1B;AAA6B,IAAA,MAAM,EAAE;AAArC,sCALF,CALD;AAgBA,CA3DD;;eA6De/B,U","sourcesContent":["import React, {useState, useEffect} from 'react';\nimport client from 'part:@sanity/base/client';\nimport {Box, Card, Stack, Spinner} from '@sanity/ui';\nimport DeployItem from './DeployItem';\n\nconst WEBHOOK_TYPE = 'webhook_deploy';\nconst WEBHOOK_QUERY = `*[_type == \"${WEBHOOK_TYPE}\"] | order(_createdAt)`;\n\n//\n// === List of Deploys ===\n//\n\nconst DeployList = () => {\n\tconst [isLoadingInitialList, setIsLoading] = useState(false);\n\tconst [webhooks, setWebhooks] = useState([]);\n\n\tconst fetchInitialList = () => {\n\t\tsetIsLoading(true);\n\n\t\tclient.fetch(WEBHOOK_QUERY).then(webhooks => {\n\t\t\tsetWebhooks(webhooks);\n\t\t\tsetIsLoading(false);\n\t\t});\n\t};\n\n\tconst onSubscriptionUpdate = res => {\n\t\tconst wasCreated = res.mutations.some(item =>\n\t\t\tObject.prototype.hasOwnProperty.call(item, 'create'),\n\t\t);\n\t\tconst wasDeleted = res.mutations.some(item =>\n\t\t\tObject.prototype.hasOwnProperty.call(item, 'delete'),\n\t\t);\n\n\t\tif (wasCreated) {\n\t\t\tsetWebhooks([...webhooks, res.result]);\n\t\t} else if (wasDeleted) {\n\t\t\tsetWebhooks(webhooks.filter(hook => hook._id !== res.documentId));\n\t\t}\n\t};\n\n\t// Fetch all to start\n\tuseEffect(fetchInitialList, []);\n\n\t// Listen to webhook changes\n\tuseEffect(() => {\n\t\tconst subscription = client\n\t\t\t.listen(WEBHOOK_QUERY, {}, {includeResult: true})\n\t\t\t.subscribe(onSubscriptionUpdate);\n\n\t\t// Unsubscribe\n\t\treturn () => {\n\t\t\tsubscription.unsubscribe();\n\t\t};\n\t}, [onSubscriptionUpdate]);\n\n\treturn isLoadingInitialList ? (\n\t\t<Box marginY={4}>\n\t\t\t<Spinner />\n\t\t</Box>\n\t) : (\n\t\t<Stack space={4}>\n\t\t\t{webhooks.map(hook => (\n\t\t\t\t<DeployItem key={hook._id} hook={hook} />\n\t\t\t))}\n\t\t\t{!webhooks.length && (\n\t\t\t\t<Card padding={4} radius={2} shadow={1}>\n\t\t\t\t\tThere are no environments yet.\n\t\t\t\t</Card>\n\t\t\t)}\n\t\t</Stack>\n\t);\n};\n\nexport default DeployList;\n"],"file":"DeployList.js"}